# Docker Compose file Reference (https://docs.docker.com/compose/compose-file/)

version: '3.8'

# Define services
services:
  wt-traefik:
    image: traefik:latest
    container_name: traefik
    ports:
      - 80:80
      - 8080:8080
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./docker/traefik:/etc/traefik
    environment:
      - "TZ=Europe/Berlin"
    networks:
      - wt-frontend-network
      - wt-backend-network

  wt-app:
    container_name: wt-app
    depends_on:
      - wt-db
    build: .
    volumes:
      - wt-picture-volume:/application/pictures
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://wt-db:5432/wine_tasting
      SPRING_DATASOURCE_USERNAME: postgres
      SPRING_DATASOURCE_PASSWORD: postgres
    networks:
      - wt-backend-network

  wt-nginx-angular:
    image: nginx:alpine
    container_name: wt-nginx-angular
    depends_on:
      - wt-app
    volumes:
      - ./docker/nginx.conf:/etc/nginx/nginx.conf
      - ./docker/Angular/dist/wine-tasting-ui/:/usr/share/nginx/html
      - wt-picture-volume:/usr/share/nginx/html/assets/wine_pictures
      - /home/ale/MyProjects/Private_Projects/vinothek_munzert_logo.png:/usr/share/nginx/html/assets/logo.png
    networks:
      - wt-backend-network

  wt-db:
    image: postgres:13
    container_name: wt-db
    environment:
      POSTGRES_PASSWORD: postgres
    volumes:
      - $HOME/docker/volumes/postgres13:/var/lib/postgresql/data
    networks:
      - wt-backend-network

volumes:
  wt-picture-volume:
    external: true
    name: wt-picture-volume

networks:
  wt-backend-network:
  wt-frontend-network:
